package com.rswebsite.online.service;

import org.apache.commons.csv.CSVFormat;
import org.apache.commons.csv.CSVRecord;


import java.io.FileReader;
import java.io.IOException;
import java.io.Reader;
import java.util.*;

import static com.rswebsite.online.util.HttpClient.asyncSinglePostRequest;
public class Test_TensorServing {

    public static void main(String[] args) throws IOException {
        Reader in = new FileReader("D:\\rswebsite\\src\\main\\resources\\webroot\\sampledata2\\item_embeddings2.csv");
        Iterable<CSVRecord> records = CSVFormat.DEFAULT.parse(in);
        records.iterator().next();
        int count = 0;
        for (CSVRecord record : records) {


            String columnOne = record.get(0);
            System.out.println(Integer.parseInt(columnOne));
            String columnTwo = record.get(1);
//            System.out.println(columnOne);
//            System.out.println(columnTwo.substring(1,columnTwo.length()-1));
            columnTwo =  columnTwo.substring(1,columnTwo.length()-1);
            String[] stateStrings = columnTwo.split(",\\s");

//            State state = new State();
            for (String element : stateStrings) {

                try{
                   Float.parseFloat(element);
                   Integer.parseInt(columnOne);
                }catch(NumberFormatException e){
                    //not float
                    ++count;
                }

            }

        }
        System.out.println(count);
//        JSONObject instance = new JSONObject();
//        String s = "[0.22193734347820282, -0.5136225819587708, -0.15135051310062408, 0.10373964160680771, 0.2132406383752823, 0.7930894494056702, 0.19471965730190277, 0.20663678646087646, 0.4008934795856476, -0.3910536468029022, 0.49232718348503113, -0.10740257054567337, 0.49552538990974426, -0.20285139977931976, -0.5399430990219116, -0.00719555513933301, -0.5821835398674011, 0.008245977573096752, 0.405107706785202, 0.27100780606269836, -0.15933406352996826, -0.30670514702796936, 0.4095739722251892, -0.638763964176178, 0.0367937907576561, -0.7184768915176392, 0.43561887741088867, 0.3468260169029236, 0.147840678691864, 0.3310181498527527, 1.00641667842865, 0.4473177492618561, -0.5749173164367676, 0.07540126144886017, -0.01627749763429165, 0.2611258625984192, 0.03395818918943405, -0.219156414270401, 0.19458480179309845, -0.028491361066699028, 0.45677080750465393, -0.0749410092830658, -0.27154484391212463, -0.024238726124167442, -0.4210333526134491, -0.06785856187343597, -0.3288547098636627, 0.6233299970626831, -0.14952024817466736, -0.15628431737422943, 0.4954383969306946, 0.7440782189369202, -0.01175971981137991, 0.2670332193374634, 0.11530177295207977, -0.021949654445052147, 0.6923132538795471, -0.1859789341688156, 0.0720616951584816, 0.18875037133693695, 0.6525303721427917, -0.2538231611251831, -0.15857410430908203, -0.16352170705795288, -0.0818098932504654, -0.24521318078041077, 0.41441458463668823, -0.10598040372133255, 0.10025256127119064, -0.1611739993095398, -0.20991463959217072, -0.14354492723941803, 0.04582502320408821, -0.6357696652412415, 0.2701878845691681, 0.3324689567089081, 0.785340428352356, -0.19170987606048584, -0.48494720458984375, 0.06087815389037132, -0.31458017230033875, 0.35503634810447693, 0.3435049057006836, 0.062349263578653336, 0.10228610783815384, -0.08730525523424149, -0.24659238755702972, -0.39806535840034485, 0.34137600660324097, 0.12050597369670868, 0.297136515378952, -0.014712435193359852, -0.6385367512702942, -0.5891436338424683, -0.06802208721637726, 0.6464401483535767, -0.09720084071159363, 0.5074577331542969, 0.3514308035373688, -0.4765755534172058, -0.0002830393787007779, -0.0032142987474799156, 0.0006813174113631248, -0.0005444981507025659, 0.0001973735197680071, 0.0017834163736552, 0.001229751156643033, -0.0010758594144135714, -0.0032481045927852392, -0.0009562826598994434, 0.0004649279871955514, -0.00013004177890252322, 0.006265654228627682, 0.0010399200255051255, 0.007081147748976946, -2.3614149995410116e-06, 0.005940466653555632, -6.6569696173246484e-06, -0.00123572105076164, -0.0026958310045301914, -0.0004421946359798312, 0.0007459567859768867, 0.00025668239686638117, 0.0031403980683535337, -6.338042294373736e-05, 0.00043531431583687663, -0.002713640918955207, -0.0008327713585458696, 0.000665435625705868, -0.0018329669255763292, 0.004872675519436598, 0.0012875975808128715, 0.005022022407501936, 0.0006080124294385314, -2.1740277588833123e-05, 0.002894718199968338, -4.851097401115112e-05, -0.0002234164858236909, 0.0004418168682605028, 0.00022448916570283473, -0.0003186527465004474, -0.00017092929920181632, -0.0019130513537675142, -2.0755353034473956e-05, 0.0031588131096214056, -0.00023780851915944368, 0.00016166505520232022, 0.0005432568141259253, -0.001242815051227808, 0.00041998119559139013, 0.003127950942143798, -0.0040715415962040424, -4.788127989741042e-05, 0.00020029291044920683, 0.00011372232984285802, 1.9839742890326306e-05, -0.0007735848776064813, 0.0013457699678838253, 0.0003353323554620147, -0.0004897942999377847, 0.0071389758959412575, 0.001678281812928617, 0.0005122787551954389, -0.0014165883185341954, -0.00039542230661027133, -0.003311995416879654, 0.0010734241222962737, -0.00021685542014893144, -3.741033287951723e-05, 0.000410771812312305, -0.001529471017420292, 0.0013117988128215075, -5.199069346417673e-05, 0.0017605923349037766, 0.0011752935824915767, 0.0032864862587302923, 0.009396707639098167, 0.00038233408122323453, 0.001965834992006421, 3.57237622665707e-05, -0.0021981087047606707, -0.001917347894050181, 0.0018967997748404741, 0.0002739947522059083, 0.00034899116144515574, -0.0007250800845213234, -3.61898128176108e-05, 0.0034454273991286755, 0.0024953053798526525, 0.0004127497668378055, -0.0017889906885102391, -0.00013010160182602704, 0.00868221279233694, 0.00417424738407135, -0.00023166813480202109, 0.005449130665510893, -0.00016396342834923416, -0.002296453807502985, 0.00044337334111332893, -0.0011354911839589477, -0.0012753121554851532, 0.006258094683289528, -0.004501586314290762, -0.0052486988715827465, 0.0009255905752070248, 0.002248695120215416, 0.006315495818853378, -0.0052065239287912846, -0.008102163672447205, 0.0024454002268612385, 0.0009443475864827633, 0.0012107882648706436, 0.012644466944038868, -0.005126511678099632, -0.013114618137478828, 0.0003281768877059221, -0.01020376943051815, -0.0008072990458458662, -0.003050351981073618, -0.009947429411113262, 0.0027752674650400877, -0.0024321626406162977, 0.0006267058197408915, -0.004916367121040821, -0.0017225847113877535, -0.0006058849394321442, -0.0062293922528624535, -0.00240112142637372, 0.004501032177358866, -0.005537360906600952, 0.004841608460992575, 0.0028784852474927902, -0.008735207840800285, 0.00806369073688984, 0.0013356031849980354, 0.011085528880357742, -0.0014285501092672348, 0.0010194384958595037, 0.0022705621086061, -0.00787920132279396, -0.0006976206786930561, 0.002280851360410452, 0.007045065984129906, 0.0008562889415770769, -0.007502524647861719, 0.003504473250359297, -0.0004916002508252859, 0.0008715396979823709, 0.00831201858818531, -0.0026872893795371056, 0.006313501391559839, -0.005471927113831043, 0.004071634262800217, 0.0007500674109905958, 0.0009863016894087195, -0.0009038749849423766, -0.0011173913953825831, -0.007236141711473465, 0.0046534063294529915, -0.0025949315167963505, 0.010940450243651867, -0.006612012162804604, -0.0032305323984473944, 0.008662998676300049, 0.004833429120481014, 0.013506595976650715, 0.0025902180932462215, 0.0020461841486394405, -0.0003731608740054071, -0.002548623364418745, 0.007286156993359327, -0.009138594381511211, -0.0011345481034368277, -0.002769229933619499, 0.00434991205111146, 0.00988509226590395, 0.011965138837695122, -0.0019943369552493095, -0.0040537090972065926, 0.0005868076113983989, 0.0069874357432127, -0.005400427151471376, 0.005521900020539761, 0.004394514486193657, 0.0034119116608053446, 0.008305113762617111, 0.00014675964484922588, -0.008655431680381298, 0.0073095508851110935, 0.003425139468163252, -0.006020770408213139, 0.008842968381941319, -0.013597045093774796, -0.0070852795615792274, 0.0034057782031595707, 0.008429443463683128, 0.0016868519596755505, -0.004525409080088139, 0.001261623459868133, 0.0023826048709452152]";
//        double d[] = {0.22193734347820282, -0.5136225819587708, -0.15135051310062408, 0.10373964160680771, 0.2132406383752823, 0.7930894494056702, 0.19471965730190277, 0.20663678646087646, 0.4008934795856476, -0.3910536468029022, 0.49232718348503113, -0.10740257054567337, 0.49552538990974426, -0.20285139977931976, -0.5399430990219116, -0.00719555513933301, -0.5821835398674011, 0.008245977573096752, 0.405107706785202, 0.27100780606269836, -0.15933406352996826, -0.30670514702796936, 0.4095739722251892, -0.638763964176178, 0.0367937907576561, -0.7184768915176392, 0.43561887741088867, 0.3468260169029236, 0.147840678691864, 0.3310181498527527, 1.00641667842865, 0.4473177492618561, -0.5749173164367676, 0.07540126144886017, -0.01627749763429165, 0.2611258625984192, 0.03395818918943405, -0.219156414270401, 0.19458480179309845, -0.028491361066699028, 0.45677080750465393, -0.0749410092830658, -0.27154484391212463, -0.024238726124167442, -0.4210333526134491, -0.06785856187343597, -0.3288547098636627, 0.6233299970626831, -0.14952024817466736, -0.15628431737422943, 0.4954383969306946, 0.7440782189369202, -0.01175971981137991, 0.2670332193374634, 0.11530177295207977, -0.021949654445052147, 0.6923132538795471, -0.1859789341688156, 0.0720616951584816, 0.18875037133693695, 0.6525303721427917, -0.2538231611251831, -0.15857410430908203, -0.16352170705795288, -0.0818098932504654, -0.24521318078041077, 0.41441458463668823, -0.10598040372133255, 0.10025256127119064, -0.1611739993095398, -0.20991463959217072, -0.14354492723941803, 0.04582502320408821, -0.6357696652412415, 0.2701878845691681, 0.3324689567089081, 0.785340428352356, -0.19170987606048584, -0.48494720458984375, 0.06087815389037132, -0.31458017230033875, 0.35503634810447693, 0.3435049057006836, 0.062349263578653336, 0.10228610783815384, -0.08730525523424149, -0.24659238755702972, -0.39806535840034485, 0.34137600660324097, 0.12050597369670868, 0.297136515378952, -0.014712435193359852, -0.6385367512702942, -0.5891436338424683, -0.06802208721637726, 0.6464401483535767, -0.09720084071159363, 0.5074577331542969, 0.3514308035373688, -0.4765755534172058, -0.0002830393787007779, -0.0032142987474799156, 0.0006813174113631248, -0.0005444981507025659, 0.0001973735197680071, 0.0017834163736552, 0.001229751156643033, -0.0010758594144135714, -0.0032481045927852392, -0.0009562826598994434, 0.0004649279871955514, -0.00013004177890252322, 0.006265654228627682, 0.0010399200255051255, 0.007081147748976946, -2.3614149995410116e-06, 0.005940466653555632, -6.6569696173246484e-06, -0.00123572105076164, -0.0026958310045301914, -0.0004421946359798312, 0.0007459567859768867, 0.00025668239686638117, 0.0031403980683535337, -6.338042294373736e-05, 0.00043531431583687663, -0.002713640918955207, -0.0008327713585458696, 0.000665435625705868, -0.0018329669255763292, 0.004872675519436598, 0.0012875975808128715, 0.005022022407501936, 0.0006080124294385314, -2.1740277588833123e-05, 0.002894718199968338, -4.851097401115112e-05, -0.0002234164858236909, 0.0004418168682605028, 0.00022448916570283473, -0.0003186527465004474, -0.00017092929920181632, -0.0019130513537675142, -2.0755353034473956e-05, 0.0031588131096214056, -0.00023780851915944368, 0.00016166505520232022, 0.0005432568141259253, -0.001242815051227808, 0.00041998119559139013, 0.003127950942143798, -0.0040715415962040424, -4.788127989741042e-05, 0.00020029291044920683, 0.00011372232984285802, 1.9839742890326306e-05, -0.0007735848776064813, 0.0013457699678838253, 0.0003353323554620147, -0.0004897942999377847, 0.0071389758959412575, 0.001678281812928617, 0.0005122787551954389, -0.0014165883185341954, -0.00039542230661027133, -0.003311995416879654, 0.0010734241222962737, -0.00021685542014893144, -3.741033287951723e-05, 0.000410771812312305, -0.001529471017420292, 0.0013117988128215075, -5.199069346417673e-05, 0.0017605923349037766, 0.0011752935824915767, 0.0032864862587302923, 0.009396707639098167, 0.00038233408122323453, 0.001965834992006421, 3.57237622665707e-05, -0.0021981087047606707, -0.001917347894050181, 0.0018967997748404741, 0.0002739947522059083, 0.00034899116144515574, -0.0007250800845213234, -3.61898128176108e-05, 0.0034454273991286755, 0.0024953053798526525, 0.0004127497668378055, -0.0017889906885102391, -0.00013010160182602704, 0.00868221279233694, 0.00417424738407135, -0.00023166813480202109, 0.005449130665510893, -0.00016396342834923416, -0.002296453807502985, 0.00044337334111332893, -0.0011354911839589477, -0.0012753121554851532, 0.006258094683289528, -0.004501586314290762, -0.0052486988715827465, 0.0009255905752070248, 0.002248695120215416, 0.006315495818853378, -0.0052065239287912846, -0.008102163672447205, 0.0024454002268612385, 0.0009443475864827633, 0.0012107882648706436, 0.012644466944038868, -0.005126511678099632, -0.013114618137478828, 0.0003281768877059221, -0.01020376943051815, -0.0008072990458458662, -0.003050351981073618, -0.009947429411113262, 0.0027752674650400877, -0.0024321626406162977, 0.0006267058197408915, -0.004916367121040821, -0.0017225847113877535, -0.0006058849394321442, -0.0062293922528624535, -0.00240112142637372, 0.004501032177358866, -0.005537360906600952, 0.004841608460992575, 0.0028784852474927902, -0.008735207840800285, 0.00806369073688984, 0.0013356031849980354, 0.011085528880357742, -0.0014285501092672348, 0.0010194384958595037, 0.0022705621086061, -0.00787920132279396, -0.0006976206786930561, 0.002280851360410452, 0.007045065984129906, 0.0008562889415770769, -0.007502524647861719, 0.003504473250359297, -0.0004916002508252859, 0.0008715396979823709, 0.00831201858818531, -0.0026872893795371056, 0.006313501391559839, -0.005471927113831043, 0.004071634262800217, 0.0007500674109905958, 0.0009863016894087195, -0.0009038749849423766, -0.0011173913953825831, -0.007236141711473465, 0.0046534063294529915, -0.0025949315167963505, 0.010940450243651867, -0.006612012162804604, -0.0032305323984473944, 0.008662998676300049, 0.004833429120481014, 0.013506595976650715, 0.0025902180932462215, 0.0020461841486394405, -0.0003731608740054071, -0.002548623364418745, 0.007286156993359327, -0.009138594381511211, -0.0011345481034368277, -0.002769229933619499, 0.00434991205111146, 0.00988509226590395, 0.011965138837695122, -0.0019943369552493095, -0.0040537090972065926, 0.0005868076113983989, 0.0069874357432127, -0.005400427151471376, 0.005521900020539761, 0.004394514486193657, 0.0034119116608053446, 0.008305113762617111, 0.00014675964484922588, -0.008655431680381298, 0.0073095508851110935, 0.003425139468163252, -0.006020770408213139, 0.008842968381941319, -0.013597045093774796, -0.0070852795615792274, 0.0034057782031595707, 0.008429443463683128, 0.0016868519596755505, -0.004525409080088139, 0.001261623459868133, 0.0023826048709452152};
//        float[] floatArray = new float[d.length];
//        for (int i = 0 ; i < d.length; i++)
//        {
//            floatArray[i] = (float) d[i];
//        }
//        instance.put("input_1",d);
//        JSONArray instances = new JSONArray();
//        instances.put(instance);
//        JSONObject instancesRoot = new JSONObject();
//        instancesRoot.put("instances",instances);
//        String predictionScores = asyncSinglePostRequest("http://localhost:8501/v1/models/recmodel:predict", instancesRoot.toString());
//        System.out.println(predictionScores);
//        JSONObject predictionsObject = new JSONObject(predictionScores);
//        JSONArray scores = predictionsObject.getJSONArray("predictions");
//        System.out.println(scores.get(0));
    }
}